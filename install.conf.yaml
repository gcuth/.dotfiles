- defaults:
    link:
      create: true
      relink: true

- clean: ['~']

# VERY BASIC GLOBAL SETTINGS:
- link:
    ~/.bashrc:
      path: bashrc
      create: true
      relink: true
      force: true
    ~/.zshrc:
      path: zshrc
      create: true
      relink: true
      force: true
    ~/.zprofile:
      path: zprofile
    ~/.vimrc:
      path: vimrc
    ~/.RProfile:
      path: RProfile
    ~/.aliases:
      path: aliases
    ~/.gitignore:
      path: gitignore
    ~/.gitconfig:
      path: gitconfig
    ~/.config/starship.toml:
      path: starship.toml
    ~/.vim/UltiSnips/markdown.snippets:
      path: snippets/vim/markdown.snippets
    ~/.newsboat/urls:
      path: newsboat/urls
    ~/.newsboat/config:
      path: newsboat/newsboatrc
    ~/.config/nvim/init.vim:
      path: nvim_init
    ~/.local/bin/:
      path: scripts/**
      glob: true
      create: true

# CREATE THE BASIC (NEEDED) DIRS
- create:
    - ~/Code/
    - ~/Recordings/
    - ~/Readings/

# BREW:
- ifmacos:
  - shell:
    - [ test -e `which brew` || /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)" ]
  - shell:
    - brew update && brew upgrade
  - brew: 
    - python
    - neovim
    - pandoc
    - leiningen
    - newsboat
    - git
    - gpg
    - fzf
    - node
    - jq
    - gh
    - chrome-cli
    - hledger
  - tap:
    - sachaos/todoist
  - brew:
    - todoist
  - tap:
    - homebrew/cask-fonts
  - brew:
    - font-fira-code
  - shell:
    - [ test -e `which toggl` || pip install togglCli ]
  - shell:
    - [ test -e /Applications/Anki.app || open "https://apps.ankiweb.net" ]
- ifubuntu:
  - shell:
    - sudo apt update && sudo apt upgrade
  - shell:
    - sudo apt install -y zsh
    - sudo apt install -y python3
    - sudo apt install -y python3-pip
    - sudo apt install -y python3-setuptools
    - sudo apt install -y python3-venv
    - sudo apt install -y neovim
    - sudo apt install -y pandoc
    - sudo apt install -y leiningen
    - sudo apt install -y newsboat
    - sudo apt install -y git
    - sudo apt install -y gnupg
    - sudo apt install -y fzf
    - sudo apt install -y nodejs
    - sudo apt install -y jq
    - sudo apt install -y hledger
    - sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-key C99B11DEB97541F0; sudo apt-add-repository https://cli.github.com/packages; sudo apt update; sudo apt install -y gh
  - shell:
    - sudo apt install -y snapd
    - sudo snap install go --classic
    - mkdir -p $GOPATH/src/github.com/sachaos; cd $GOPATH/src/github.com/sachaos; git clone https://github.com/sachaos/todoist.git; cd todoist; make install
  - shell:
    - sudo apt install -y fonts-firacode
  - shell:
    - [ test -e `which toggl` || sudo pip3 install togglCli ]
  - shell:
    - sudo apt install -y anki

# if you don't already have them, you probably want them:
- shell:
  - if [ ! -d "/Users/g/Documents/thesis" ]; then git clone git@github.com:gcuth/phd_thesis.git ~/Documents/thesis; fi
  - if [ ! -d "/Users/g/Documents/blog" ]; then git clone git@github.com:gcuth/gcuth.github.io.git ~/Documents/blog; fi

# # link hooks:
- link:
    ~/Documents/blog/.git/hooks/pre-commit:
      path: hooks/blog-pre-commit

# install starship for enlivening the prompt a little
- shell:
    - curl -fsSL https://starship.rs/install.sh -o ./starship.sh; bash ./starship.sh -y; rm ./starship.sh

# INSTALL BABASHKA
- shell:
    - [ test -f `which bb` || curl -fsSL https://raw.githubusercontent.com/borkdude/babashka/master/install -o ./install-babashka; chmod +x ./install-babashka && sudo ./install-babashka; rm ./install-babashka ]

# cron setup
- ifmacos:
  - crontab:
    - cron: 0,5,10,15,20,25,30,35,40,45,50,55 * * * *
      command: /opt/homebrew/bin/git -C /Users/g/Documents/thesis add .; /opt/homebrew/bin/git -C /Users/g/Documents/thesis/ commit -m 'Auto-commit' >/dev/null 2>&1
    - cron: 0,10,20,30,40,50 * * * *
      command: /opt/homebrew/bin/git -C /Users/g/Documents/blog add .; /opt/homebrew/bin/git -C /Users/g/Documents/blog/ commit -m 'Auto-commit' >/dev/null 2>&1
    - cron: 1 * * * *
      command: /opt/homebrew/bin/git -C /Users/g/Documents/thesis push origin master >/dev/null 2>&1
    - cron: 1 * * * *
      command: /opt/homebrew/bin/git -C /Users/g/Documents/blog push origin master >/dev/null 2>&1
    - cron: 0,10,20,30,40,50 * * * *
      command: /opt/homebrew/bin/todoist sync >/dev/null 2>&1
    - cron: 5,35 * * * *
      command: /opt/homebrew/bin/toggl ls --fields 'id,workspace,description,project,task,billable,start,stop,duration,tags' >> /Users/g/Documents/blog/data/logs/toggl
    - cron: 5,35 * * * *
      command: /opt/homebrew/bin/todoist --csv completed-list --filter 'today' >> /Users/g/Documents/blog/data/logs/completed_tasks.csv
    - cron: 5,35 * * * *
      command: /opt/homebrew/bin/python3 /Users/g/Documents/blog/crypto.py >> /Users/g/Documents/blog/data/logs/crypto.csv
    - cron: 3,13,23,33,43,53 * * * *
      command: /Users/g/.dotfiles/scripts/tasker generate >/dev/null 2>&1
    - cron: 0,5,10,15,20,25,30,35,40,45,50,55 * * * *
      command: for TAB in `chrome-cli list tabs | grep "YouTube" | sed 's/\].*//g' | sed 's/\[//g'`; do chrome-cli close -t $TAB; done >/dev/null 2>&1

- ifubuntu:
  - crontab:
    - cron: 0,5,10,15,20,25,30,35,40,45,50,55 * * * *
      command: git -C ~/Documents/thesis add .; git -C ~/Documents/thesis/ commit -m 'Auto-commit' >/dev/null 2>&1
    - cron: 0,10,20,30,40,50 * * * *
      command: git -C ~/Documents/blog add .; git -C ~/Documents/blog/ commit -m 'Auto-commit' >/dev/null 2>&1
    - cron: 1 * * * *
      command: git -C ~/Documents/thesis push origin master >/dev/null 2>&1
    - cron: 1 * * * *
      command: git -C ~/Documents/blog push origin master >/dev/null 2>&1
    - cron: 0,10,20,30,40,50 * * * *
      command: /usr/bin/todoist sync >/dev/null 2>&1

- shell: 
  - ['test -f ~/.vim/autoload/plug.vim || curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim', 'Installing vim-plug (if needed)']
  - command: ['vim -c PlugInstall', 'Please observe any error messages and quit vim afterwards.']
    stdin: true
    stdout: true
    stderr: true


