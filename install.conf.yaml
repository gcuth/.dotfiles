###############################################################################
###################### DEFAULT BEHAVIOUR FOR LINKING ETC ######################
###############################################################################

- defaults:
    link:
      create: true
      relink: true

    brew:
        stdin: true
        stderr: true
        stdout: true

    cask:
        stdin: true
        stderr: true
        stdout: true

    brewfile:
        stdin: true
        stderr: true
        stdout: true


- shell:
  - [git submodule update --init --recursive, Installing submodules]


###############################################################################
################################# CLEAN START #################################
###############################################################################

- clean: ['~', '~/.local/bin/', '~/Library/Application Support/Code/User/snippets/']


###############################################################################
############### CREATE THE BASIC DIRECTORY FOR ALL DEV PROJECTS ###############
###############################################################################

- create:
    - ~/Developer/ # main directory for all dev projects
    - ~/Torrents/  # directory for torrent downloads etc
    - ~/Logs/      # convenience for lil script logs etc


###############################################################################
############### LINK GLOBAL SETTINGS FILES, SNIPPETS, & SCRIPTS ###############
###############################################################################

- link:
    ~/.zshrc:
      path: zshrc
      create: true
      relink: true
      force: true
    ~/.stack/config.yaml:
      path: stack/config.yaml
    ~/.zprofile:
      path: zprofile
    ~/.profile:
      path: profile
    ~/.RProfile:
      path: RProfile
    ~/.aliases:
      path: aliases
    ~/.gitignore:
      path: git/ignore
    ~/.gitconfig:
      path: git/config
    ~/.config/starship.toml:
      path: starship.toml
    ~/.local/bin/:
      path: scripts/**
      glob: true
      create: true
    ~/.lein/profiles.clj:
      path: lein/profiles.clj
    ~/Library/Application Support/Code/User/settings.json:
      path: vscode/settings.json
      create: true
      relink: true
      force: true
    ~/Library/Application Support/Code/User/snippets/:
      path: snippets/**
      glob: true
      create: true


###############################################################################
######################## INSTALL & SETUP DEFAULT STACK ########################
###############################################################################

# BREW INSTALLS
- shell:
  - [ test -e `which brew` || /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)" ]
- shell:
  - brew update && brew upgrade
- cask: # install 1password first so that we can use it to authenticate others
  - 1password
- brew:
  - python
  - pipx
  - nvm
  - neovim
  - pandoc
  - java
  - leiningen
  - git
  - git-lfs
  - gpg
  - fzf
  - jq
  - gh
  - ffmpeg
  - rclone
  - tmux
  - rust
  - borkdude/brew/babashka
  - ripgrep
  - gdu
  - discord
  - docker
  - starship
  - obsidian
  - sqlite
  - sqlcipher
  - visual-studio-code
  - postgresql
  - coreutils # the missing GNU coreutils, macOS style
  - ollama
  - 1password-cli
  - iterm2
- cask:
  - signal
  - anki
  - font-fira-code
  - font-hack-nerd-font
  - textexpander
  - rescuetime
  - protonvpn
  - protonmail-bridge
  - proton-drive
  - zotero
  - zoom
  - bartender
  - transmission


###############################################################################
################# INSTALL REMAINING APPS (IF NOT YET PRESENT) #################
###############################################################################

- shell:
  - [ test -e /Applications/Audio\ Hijack.app || open "https://rogueamoeba.com/audiohijack/download.php" ]


###############################################################################
############################## VSCODE EXTENSIONS ##############################
###############################################################################

# IF VSCODE EXISTS, INSTALL BASIC EXTENSIONS FROM FILE
- shell:
  - [ test -e `which code` && cat /Users/g/.dotfiles/vscode/extensions.txt | xargs -n 1 code --install-extension ]


###############################################################################
################################## CRON JOBS ##################################
###############################################################################

- crontab:
  # every minute, log the currently playing song (if any) to a csv file
  - cron: "* * * * *"
    command: osascript /Users/g/.dotfiles/applescripts/tunes.js >> ~/Library/Mobile\ Documents/iCloud\~is\~workflow\~my\~workflows/Documents/Logs/Consumption/Music/playing.csv
  # every minute, set the One Thing menu bar item to match writing progress
  - cron: "* * * * *"
    command: open --background 'one-thing:?text='"$(/opt/homebrew/bin/bb ~/.dotfiles/scripts/logwords.bb --dir ~/Library/Mobile\ Documents/iCloud~md~obsidian/Documents/ --log ~/Logs/word_delta.log | tr -d "\n")"
  # Run the 'every five minutes' shortcut
  - cron: "*/5 * * * *"
    command: shortcuts run "Every Five Minutes"
  # run the 'every hour' shortcut every hour at 59 minutes past
  - cron: "59 * * * *"
    command: shortcuts run "Every Hour"
  # Run the misc 'every day' shortcut every day at 4am
  - cron: "0 4 * * *"
    command: shortcuts run "Every Day"
